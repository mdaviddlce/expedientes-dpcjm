<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title or "EXPEDIENTES Â· DPCJM" }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
  <meta name="color-scheme" content="light dark">
</head>
<body>
  <header class="topbar glass">
    <div class="topbar__left">
      <a class="brand" href="{{ url_for('index') }}">
        <span class="brand__dot" aria-hidden="true"></span>
        <span class="brand__text">
          <span class="brand__title">EXPEDIENTES</span>
          <span class="brand__sub">DEPARTAMENTO DE PROTECCION CIVIL Â· DPCJM</span>
        </span>
      </a>
    </div>

    <div class="topbar__right">
      {% if session.get("user_id") %}
        <div class="userpill">
          <div class="userpill__name">{{ session.get("username") }}</div>
          <div class="userpill__role">{{ session.get("role") }}</div>
        </div>

        <!-- MODULO DE USUARIOS -->
        {% if session.get("role") == "ADMINISTRADOR" %}
        <a class="btn btn--ghost" href="{{ url_for('users_list') }}">USUARIOS</a>
        {% endif %}

        <button class="btn btn--ghost" id="themeToggle" type="button" title="Cambiar tema">
          <span class="icon" aria-hidden="true">ðŸŒ“</span>
          <span class="hide-sm">TEMA</span>
        </button>

        {% if session.get("role") in ["CAPTURA","ADMINISTRADOR"] %}
          <a class="btn" href="{{ url_for('expediente_new') }}">+ NUEVO</a>
        {% endif %}

        <form method="post" action="{{ url_for('logout_post') }}" class="inline">
          <button class="btn btn--ghost" type="submit">SALIR</button>
        </form>
      {% endif %}
    </div>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="stack">
          {% for category, msg in messages %}
            <div class="toast {{ 'toast--ok' if category=='ok' else 'toast--err' }}">
              <div class="toast__row">
                <div class="toast__msg">{{ msg }}</div>
                <div class="toast__actions">
                  <a class="btn btn--ghost btn--sm" href="{{ url_for('index') }}">INICIO</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

    <script src="{{ url_for('static', filename='app.js') }}?v=1"></script>
</body>
</html>